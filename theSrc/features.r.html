<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="styles/main.css">
  </head>
  <body>
    <script src="external/lodash.min.js"></script>
    <script src="external/jquery.min.js"></script>
    <script src="external/d3.min.js"></script>
    <script src="external/d3-grid.js"></script>

    <pre style="padding-left:20px" class="pre-content"></pre>
    <!-- NB This script should be defined before rhtmlPictographs.js is loaded-->
    <script>

      $('.pre-content').append($('<span>').html('library("devtools")'));
      $('.pre-content').append($('<br>'));
      $('.pre-content').append($('<span>').html('install_github("NumbersInternational/rhtmlPictographs")'));
      $('.pre-content').append($('<br>'));
      $('.pre-content').append($('<br>'));

      $(document).ready( function() {
        console.log("Document ready. Fetching scenarios");


        $.ajax('./theSrc/features/features.json').done(function (response) {

          _.forEach(response.features, function(feature) {
            $('.pre-content').append($('<span>').html('#' + feature.name));
            $('.pre-content').append($('<br>'));
            _.forEach(feature.scenarios, function(scenario) {
              $('.pre-content').append($('<span>').html('##' + scenario.name));
              $('.pre-content').append($('<br>'));
              _.forEach(scenario.description, function(line) {
                $('.pre-content').append($('<span>').html('###' + line));
                $('.pre-content').append($('<br>'));
              });

              percentage = _.has(scenario.settings, 'percentage') ? scenario.settings.percentage : 'NULL';

              rCommand = 'rhtmlPictographs::graphic(' +
                percentage + ',' +
                scenario.width + ',' +
                scenario.height + ',' +
                "'" + (scenario.settingsString || JSON.stringify(scenario.settings)) + "'" +
                ')';

              $('.pre-content').append($('<span>').html(rCommand));
              $('.pre-content').append($('<br>'));
              $('.pre-content').append($('<br>'));

            });
          });

        }).fail( function(error) {
          console.error("Download of ./theSrc/features/features.json failed. Probably invalid JSON.");
          console.error(error);
          $('body').append($('<div>').text("Failure to download/parse ./theSrc/features/features.json (probably invalid JSON). See dev tools console for error logging."));
        });
      });
    </script>

    <script src="scripts/rhtmlPictographs.js"></script>
  </body>
</html>
