<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="styles/main.css">
  </head>
  <body>
    <script src="external/lodash.min.js"></script>
    <script src="external/jquery.min.js"></script>
    <script src="external/d3.min.js"></script>
    <script src="external/d3-grid.js"></script>

    <pre style="padding-left:20px" class="pre-content"></pre>
    <!-- NB This script should be defined before rhtmlPictographs.js is loaded-->
    <script>

      $('.pre-content').append($('<span>').html('library("devtools")'));
      $('.pre-content').append($('<br>'));
      $('.pre-content').append($('<span>').html('install_github("NumbersInternational/rhtmlPictographs")'));
      $('.pre-content').append($('<br>'));
      $('.pre-content').append($('<br>'));

      $(document).ready( function() {
        console.log("Document ready. Fetching scenarios");


        $.ajax('./resources/data/scenarios.json').done(function (response) {

          _.forEach(response.features, function(feature) {
            $('.pre-content').append($('<span>').html('#' + feature.name));
            $('.pre-content').append($('<br>'));
            _.forEach(feature.scenarios, function(scenario) {
              $('.pre-content').append($('<span>').html('##' + scenario.name));
              $('.pre-content').append($('<br>'));
              _.forEach(scenario.description, function(line) {
                $('.pre-content').append($('<span>').html('###' + line));
                $('.pre-content').append($('<br>'));
              });

//rhtmlPictographs::graphic(0.8, 400, 400, '{"numImages": 22, "numRows": 6, "baseImageUrl": "https://s3-ap-southeast-2.amazonaws.com/kyle-public-numbers-assets/htmlwidgets/CroppedImage/black_square_512.png", "variableImageUrl": "https://s3-ap-southeast-2.amazonaws.com/kyle-public-numbers-assets/htmlwidgets/CroppedImage/blue_square_512.png", "text-header": "Big header", "text-footer": "Big footer", "font-family": "verdana", "font-weight": "900", "font-size": "24px", "font-color": "blue"}')
              rCommand = 'rhtmlPictographs::graphic(' +
                scenario.percentage + ',' +
                scenario.width + ',' +
                scenario.height + ',' +
                "'" + JSON.stringify(scenario.settings) + "'" +
                ')';

              $('.pre-content').append($('<span>').html(rCommand));
              $('.pre-content').append($('<br>'));
              $('.pre-content').append($('<br>'));

            });
          });

        }).fail( function(error) {
          console.error("Download of ./resources/data/scenarios.json failed. Probably invalid JSON.");
          console.error(error);
          $('body').append($('<div>').text("Failure to download/parse ./resources/data/scenarios.json (probably invalid JSON). See dev tools console for error logging."));
        });
      });
    </script>

    <script src="scripts/rhtmlPictographs.js"></script>
  </body>
</html>
